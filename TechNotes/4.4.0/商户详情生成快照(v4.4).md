商户详情生成快照（v4.4）
-------

### 1.需求
将商户详情页的推荐图文内容生成快照分享到朋友圈

### 2.技术实现分析
方案 1：使用 webView 加载快照中要显示的内容，然后对 webView 进行截图。
方案 2：获取图文详情相关数据，根据不同数据绘制 view，再根据 view 生成截图。

在尝试方案 1 时遇到了以下两个问题：
1.高度问题——由于 webView 没有 superView，导致其背后的 scrollView 的 contentSize 计算不出来
解决办法是，将 webView 添加到屏幕上的 view hierarchy 中，并使其不可见，截图后再移除 webView。

2.图片加载问题——只加载了第一屏高度的图片
解决办法是，在第一次 -webViewDidFinishLoad: 成功回调时，reload 一次，但是等待时间会有点长。

关于 webView 截图的实践见 [SCSnapshotManager](https://github.com/ShannonChenCHN/SCSnapshotManager)

方案 1 的优势在于 h5 的灵活度，方案 2 的优势在于可靠性和用户体验，综合考虑，我们决定还是采用方案 2。

### 3.做了哪些工作

### 4.延伸阅读：

1.[Loading hidden/offscreen UIWebView](http://stackoverflow.com/a/21888779/7088321)
2.[我只是想要截个屏](http://blog.startry.com/2016/02/24/Screenshots-With-SwViewCapture/)



-------------------------------------

[商户详情页分享快照]()http://jira.corp.yhouse.com/browse/YS-5976)


一、背景：
1、更有逼格的分享方式；
2、会员卡售卖传播的一种方式；

二、功能与需求：

美食、美容/SPA、夜生活入驻商户详情页的分享渠道里增加朋友圈快照和保存快照的功能；

具体功能和图文的快照功能一样：
朋友圈快照：生成—跳转微信朋友圈分享渠道
保存快照：生成—保存至用户的系统相册



由于商户详情页中，推荐理由不是必然有的，而且有些商户是具有会员卡权益的商户


具体的快照展现样式见：【快照展示】
- 非会员商户无推荐
- 非会员商户有推荐
- 会员商户无推荐
- 会员商户有推荐


需要哪些信息：

===============
头图
——————
标题 ---------> 取商户亮点详情1
————————
N 人拔草------> 新字段
————————
商户名  ------> 商户名字段

====================
亮点详情
————————
图文详情 ------> 
（有推荐显示推荐和图片、没有就只显示图片）

====================
会员权益 titleView
——————————
赠送招牌菜促销广告
——————————
招牌菜名
——————————
招牌菜权益亮点
——————————
招牌菜图片

====================

二维码
——————————
二维码描述语

==============



1.分享菜单入口
2.获取数据
3.绘制 view
4.重构 YHSnapshotManager


Model 校验和转换  ----> 生成二维码  ----->  下载图片 ----> 生成 view 、排版  ----> 生成快照图片 

Model 的复用：qrCodeImage、shareSnapUrl
哪些能复用、能抽象出来？



增加几个 view 的 category


职责分明

由类簇模式改为 provider 模式

// 如何提高程序的健壮性？
- TDD
- 边界条件
- 出错时的处理
- 保护措施（数组越界、插入空值等）
- 日志上报

// 核心思想
- 如何减低错误率/bug
- 如何减低崩溃率
- 出现问题时怎么查找、追踪


### Checklist（TTD）

- 埋点
- 图文快照分享成功后发送请求告诉服务器任务完成
- 图文快照不同入口
   - 社区图文贴
   - 榜单
   - 红包活动
- 二维码分享文案
   - 配置文件是否有效
   - 是否取到了 app init 接口返回的字段数据
- 成功和失败的各种处理
- 错误上报
- 图文帖各种情况
- 商户详情各种情况
	- 非会员商户无推荐
	- 非会员商户有推荐
	- 会员商户无推荐
	- 会员商户有推荐
- 图文帖各种为空的情况
    - 标题
    - 图片
    - 文字
- 商户详情各种为空的情况
    - 标题
    - 图片
    - 文字
